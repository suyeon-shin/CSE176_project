import lightgbm as lgb
import pandas as pd
from sklearn.model_selection import GridSearchCV
from sklearn.metrics import mean_squared_error
from sklearn.datasets import load_breast_cancer
from sklearn.model_selection import train_test_split
import time
from sklearn.decomposition import PCA

start_time = time.time()

# Load the dataset
data_file = pd.read_csv(r'C:\rbi_reg_cs_176\venv\train.csv')

y = data_file['critical_temp']
X = data_file.drop('critical_temp', axis=1)

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)

# Set the hyperparameters for the LightGBM model
params = {
    'objective': 'regression',
    'metric': 'rmse',
    'num_leaves': 50,
    'learning_rate': 0.05,
    'n_estimators': 3000
}

model = lgb.LGBMRegressor(**params)

model.fit(X_train, y_train)

y_pred = model.predict(X_test)
accuracy = mean_squared_error(y_test, y_pred, squared=False)
print(f'Test accuracy: {accuracy}')

# PCA
pca = PCA(n_components=41)
X_train_pca = pca.fit_transform(X_train)
X_test_pca = pca.transform(X_test)

model.fit(X_train_pca, y_train)

y_pred_pca = model.predict(X_test_pca)
accuracy_pca = mean_squared_error(y_test, y_pred_pca, squared=False)
print(f'Test accuracy with PCA: {accuracy_pca}')

end_time = time.time()

print(f"Execution time: {end_time - start_time} seconds")
